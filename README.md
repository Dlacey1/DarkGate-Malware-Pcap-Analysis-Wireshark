<h1>DarkGate-Malware-Pcap-Analysis-Wireshark</h1>
<h2>Introduction</h2>
<p>Recently, I was presented with a .pcap file to analyze. I had no information or direction other than to search for malicious activity and report my findings. These are the highlights from that investigation. </p>
 
The original .pcap file can be downloaded [here](https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/raw/main/malicious_activity.pcap).

<h2>Indicators of Compromise</h2>
<ol>
  <li>Asymmetric incoming TCP ACK traffic indicative of downloads taking place.</li>
<br/>
<img src=https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/blob/main/Images/Picture1.png>
<br />
<br />

  <li>DNS redirection (302 Temporarily Moved), then lots of traffic with the German IP address 83.169.26.68 while all other traffic is within the United States. </li>
<br/>
<img src=https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/blob/main/Images/Picture2.png>
<br />
<br />

  <li>The URL’s “higreens.co.in” (192.185.129.222) and “duelmener-naturtrailpark.org” (83.169.26.68) are both flagged as part of DarkGate Malware network as per VirusTotal. </li>
  <br/>
<img src=https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/blob/main/Images/Picture3.png>
<br />
<br />
  <br/>
<img src=https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/blob/main/Images/Picture4.png>
<br />
<br />

  <li>Entry 6970 confirms the successful download (200 OK) of the roamingkiller.zip file, which contains DarkGate payload (MSI file) as indicated in entry 6997.</li>
  <br/>
<img src=https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/blob/main/Images/Picture5.png>
<br />
<br />

  <li>After the download, the infected system communicates with C2 (138.124.183.23) using text/html, which is also characteristic of DarkGate.</li>
    <br/>
<img src=https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/blob/main/Images/Picture6.png>
<br />
<br />

  <li>I downloaded the .zip file from entry 6970 and checked it with VirusTotal, and it came back as positive for DarkGate Trojan. SHA256 hash: 1efbfb8f9e441370bb3f3a316fea237564eefebbf4ba33cccdae5f853c86a7b0</li>
    <br/>
<img src=https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/blob/main/Images/Picture7.png>
<br />
<br />

  <li>Ran the file using AnyRun to observe behavior.</li>
    <br/>
<img src=https://github.com/Dlacey1/DarkGate-Malware-Pcap-Analysis-Wireshark/blob/main/Images/Picture8.png>
<br />
<br />
<li>AnyRun did not execute the entire process, but did show an executable was dropped. Next, I did an infection run on a Windows 10 virtual machine, which generated several files all linked to DarkGate.</li>

<br/>

</ol>
<h2>Summary of Findings</h2>

<h3>Attack Lifecycle</h3>
<ul>
  <li>A compromised URL was clicked. This led to a compromised website associated with DarkGate malware being visited. This visit ultimately resulted in the download of the DarkGate malware payload .msi file. DarkGate was installed, and communication with C2 using text/html was initiated.</li>
</ul>
<h3>Infected Machine</h3>
<ul>
  <li>Mac- 00:08:02:1c:47:ae</li>
  <li>IP- 10.1.25.101</li>
</ul>
<h3>Origin</h3>
<ul>
  <li>Compromised URL/Website- higreens.co.in</li>
</ul>
<h3>Confirmed Malware Type</h3>
<ul>
  <li>DarkGate</li>
</ul>

